**【メダロットE】解説書**


**プロジェクト概要**

このプロジェクトは、人気ゲーム「メダロット」の戦闘システムをリスペクトした、EbitenとECS（エンティティ・コンポーネント・システム）アーキテクチャによるバトルシミュレーションゲームです。
ECSライブラリには donburi を採用しており、データ指向の設計に基づいています。


Core & Entry Point (中核・起動)

    main.go

        役割: プログラムの起動点（エントリーポイント）。

        内容: ウィンドウの初期化、フォントや設定ファイルの読み込み、ゲーム全体のメインループの開始。

    game.go

        役割: ゲーム全体のシーン（画面）を管理するシーンマネージャー。

        内容: 現在のシーンを保持し、シーン間の遷移（例：タイトル→バトル）を制御する。UpdateとDrawの司令塔。

    config.go

        役割: ゲームの固定設定値を管理する。

        内容: ゲームバランス（攻撃力係数など）、UIのサイズや色といった、マジックナンバーになりがちな値を一元管理する。

Scene (各画面の実装)

    scene.go

        役割: すべてのシーンが満たすべき共通のルール（インターフェース）を定義。

        内容: Update, Drawメソッドの型定義。シーン間で共有するリソース（SharedResources）の定義。

    scene_title.go

        役割: タイトル画面の実装。

    scene_battle.go

        役割: 戦闘シーンの統括。

        内容: 戦闘用のWorld（ECS）、UI、ゲーム状態（StatePlaying, StateGameOverなど）を管理し、各システムを適切なタイミングで呼び出す。

    scene_customize.go

        役割: メダロットのカスタマイズ画面の実装。

    scene_placeholder.go

        役割: 未実装画面などのための、汎用的なプレースホルダー画面。

ECS (エンティティ・コンポーネント・システム)

    components.go

        役割: [データ] の定義。ECSの「C（コンポーネント）」。

        内容: エンティティを構成する部品（Settings, Parts, Gaugeなど）や、状態を示すタグ（IdleState, DefenseDebuffなど）のデータ構造をすべて定義する。新しいデータや状態を追加したい場合は、まずこのファイルを編集する。

    systems.go

        役割: [ロジック/振る舞い] の実装。ECSの「S（システム）」。

        内容: ゲームのルールを実装した関数の集まり。「ゲージを進める」「行動準備ができたエンティティの行動を実行する」「待機中のAIに行動を選択させる」など。ゲームのルールを変更したい場合は、このファイルを編集する。

    ecs_setup.go

        役割: 戦闘開始時のエンティティ生成。

        内容: CSVから読み込んだデータをもとに、戦闘に参加する全メダロットのエンティティと初期コンポーネントを作成する。

Game Logic & AI (戦闘ルールと思考)

    battle_logic.go

        役割: 戦闘中のコアな計算ロジック。

        内容: 命中判定、ダメージ計算、防御判定、ターゲット選択など、単発で完結する計算処理をまとめた関数群。systems.goから頻繁に呼び出される。

    ai.go

        役割: 敵（AI）の思考ルーチン。

        内容: メダルの性格に基づき、どのパーツで誰のどこを狙うか、といった行動選択ロジックを実装する。

    player_actions.go

        役割: プレイヤーの行動選択に関連するヘルパー関数。

        内容: プレイヤーが行動を選択する際の、ターゲット候補の選択などを補助する。

UI (ユーザーインターフェース)

    ui.go

        役割: 戦闘画面UI全体のレイアウトと管理。

        内容: 左右の情報パネル、中央のバトルフィールドといったUIの骨格を組み立て、モーダルウィンドウの表示/非表示などを管理する。

    battlefield_widget.go

        役割: 中央のバトルフィールド描画。

        内容: メダロットアイコン、ホームマーカー、ゲージ、ターゲットインジケーターなどの描画処理。

    ui_info_panels.go

        役割: 左右の情報パネル（HPゲージなど）の作成と更新。

    ui_action_modal.go

        役割: プレイヤーの行動選択モーダルウィンドウ。

    ui_message_window.go

        役割: 画面下のメッセージウィンドウ（「～の攻撃！」など）。

Data & Utilities (データ定義と補助機能)

    types.go

        役割: プロジェクト全体で使われる基本的な型や定数の定義。

        内容: TeamID, PartSlotKey, StateTypeのような型定義や、constで定義される定数を集約する。

    csv_loader.go

        役割: dataフォルダにあるCSVファイルの読み込み/保存。

        内容: パーツ、メダル、メダロット構成のデータをファイルから読み込む。